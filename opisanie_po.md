# Описание программного обеспечения Health Tracker

## Общая информация

**Название:** Health Tracker (Трекер здоровья)

**Версия:** 1.0.0

**Тип:** Мобильное приложение для учета здоровья

**Платформы:** iOS, Android

**Архитектура:** Полностью локальное приложение (offline-first)

---

## Технологический стек

### Языки программирования

- **TypeScript** (основной язык)
  - Версия: 5.1.3
  - Строгая типизация для надежности кода
  - Все компоненты, сервисы и утилиты написаны на TypeScript

- **JavaScript** (ES6+)
  - Используется для конфигурационных файлов (babel.config.js, package.json)
  - Node.js для инструментов разработки

- **SQL** (SQLite)
  - Для создания схем базы данных
  - Запросы к локальной базе данных

### Основные технологии и библиотеки

#### Frontend Framework
- **React Native** (версия 0.81.5)
  - Кроссплатформенный фреймворк для разработки мобильных приложений
  - Позволяет разрабатывать для iOS и Android из одного кода

- **React** (версия 19.1.0)
  - UI библиотека для построения интерфейсов
  - Компонентная архитектура

#### Expo SDK
- **Expo SDK 54**
  - Платформа для разработки React Native приложений
  - Предоставляет готовые API и инструменты
  - Упрощает разработку и развертывание

#### Навигация
- **React Navigation** (6.1.9)
  - @react-navigation/native
  - @react-navigation/bottom-tabs
  - Навигация между экранами через bottom tabs

#### Управление состоянием
- **Zustand** (4.4.7)
  - Легковесная библиотека для управления глобальным состоянием
  - Хранение настроек приложения (тема, профиль симуляции, источник данных)

#### База данных
- **expo-sqlite** (16.0.10)
  - SQLite база данных для локального хранения
  - Полностью offline-first подход
  - Все данные хранятся локально на устройстве

#### Хранение настроек
- **@react-native-async-storage/async-storage** (2.2.0)
  - Асинхронное хранилище ключ-значение
  - Используется для сохранения пользовательских настроек

#### Визуализация данных
- **Victory Native** (37.3.4)
  - Библиотека для построения графиков и диаграмм
  - Используется для отображения трендов метрик здоровья

- **react-native-svg** (15.12.1)
  - Поддержка SVG графики
  - Необходима для Victory Charts

#### Анимации
- **react-native-reanimated** (4.1.1)
  - Высокопроизводительные анимации на нативном уровне
  - Используется для плавных переходов и интерактивных элементов

- **react-native-gesture-handler** (2.28.0)
  - Управление жестами и сенсорными взаимодействиями
  - Интеграция с react-native-reanimated

- **react-native-worklets** (0.5.1)
  - Рабочие потоки для выполнения кода на UI потоке
  - Необходима для react-native-reanimated 4.x

#### Дополнительные библиотеки
- **date-fns** (3.0.0)
  - Утилиты для работы с датами и временем
  - Форматирование, разница между датами

- **expo-status-bar** (3.0.9)
  - Управление статус-баром устройства

- **react-native-safe-area-context** (5.6.0)
  - Безопасные зоны для различных устройств (вырез, notch)

- **react-native-screens** (4.16.0)
  - Оптимизация нативных экранов

---

## Архитектура приложения

### Структура проекта

```
healt/
├── src/
│   ├── components/          # Переиспользуемые UI компоненты
│   │   ├── HealthMetricCard.tsx      # Карточка метрики здоровья
│   │   ├── RecommendationCard.tsx    # Карточка рекомендации
│   │   ├── TrendChart.tsx            # График тенденций
│   │   └── LoadingSpinner.tsx        # Индикатор загрузки
│   │
│   ├── screens/             # Экраны приложения
│   │   ├── DashboardScreen.tsx       # Главная панель
│   │   ├── HealthMetricsScreen.tsx   # Все метрики здоровья
│   │   ├── ActivityLogScreen.tsx     # Журнал активности
│   │   ├── AnalyticsScreen.tsx       # Аналитика и графики
│   │   ├── RecommendationsScreen.tsx # Рекомендации
│   │   └── SettingsScreen.tsx        # Настройки
│   │
│   ├── database/            # Работа с базой данных
│   │   ├── schema.ts                 # SQL схемы таблиц
│   │   └── database.ts               # CRUD операции
│   │
│   ├── simulation/          # Симуляторы данных
│   │   ├── base.ts                   # Базовые функции и профили
│   │   ├── heartRate.ts              # Симуляция ЧСС
│   │   ├── steps.ts                  # Симуляция шагов
│   │   ├── sleep.ts                  # Симуляция сна
│   │   ├── weight.ts                 # Симуляция веса
│   │   ├── water.ts                  # Симуляция воды
│   │   ├── calories.ts               # Симуляция калорий
│   │   └── index.ts                  # Главный симулятор
│   │
│   ├── services/            # Бизнес-логика
│   │   ├── simulationService.ts      # Сервис симуляции
│   │   └── recommendations.ts        # Движок рекомендаций
│   │
│   ├── store/               # Управление состоянием
│   │   └── useStore.ts               # Zustand store
│   │
│   ├── types/               # TypeScript типы
│   │   └── index.ts                  # Все типы и интерфейсы
│   │
│   └── utils/               # Утилиты
│       ├── colors.ts                 # Цветовая схема (светлая/темная)
│       └── format.ts                 # Форматирование данных
│
├── App.tsx                  # Главный компонент приложения
├── index.js                 # Точка входа
├── package.json             # Зависимости проекта
├── tsconfig.json            # Конфигурация TypeScript
├── babel.config.js          # Конфигурация Babel
└── app.json                 # Конфигурация Expo
```

---

## База данных

### Система управления базами данных

**SQLite** - встраиваемая реляционная база данных

- Полностью локальная база данных
- Не требует сервера
- Хранится в файле на устройстве: `healthtracker.db`
- Использует библиотеку `expo-sqlite` для доступа

### Схема базы данных

#### Таблица: `health_metrics`

Хранит все метрики здоровья пользователя.

```sql
CREATE TABLE IF NOT EXISTS health_metrics (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  metric_type TEXT NOT NULL,        -- Тип метрики
  value REAL NOT NULL,               -- Значение
  timestamp DATETIME NOT NULL,       -- Временная метка
  source TEXT DEFAULT 'simulation'   -- Источник данных
);
```

**Типы метрик (metric_type):**
- `heart_rate` - Частота сердечных сокращений (ЧСС)
- `steps` - Количество шагов
- `distance` - Пройденное расстояние (км)
- `weight` - Вес (кг)
- `bmi` - Индекс массы тела
- `water` - Потребление воды (мл)
- `calories` - Калории (ккал)
- `sleep_duration` - Продолжительность сна (часы)
- `sleep_quality` - Качество сна (%)
- `breathing_rate` - Частота дыхания (вдохов/мин)
- `stress_level` - Уровень стресса (0-100)
- `activity` - Активность

**Источники данных (source):**
- `simulation` - Симулированные данные
- `IMSIT Watch` - Данные с умных часов IMSIT
- `Device` - Данные с устройства (HealthKit/Google Fit)

**Индексы:**
- `idx_metrics_type_timestamp` - на (metric_type, timestamp) для быстрого поиска

#### Таблица: `goals`

Хранит цели пользователя по метрикам.

```sql
CREATE TABLE IF NOT EXISTS goals (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  type TEXT NOT NULL,              -- Тип метрики
  target_value REAL NOT NULL,      -- Целевое значение
  current_value REAL DEFAULT 0,    -- Текущее значение
  deadline DATE,                   -- Срок достижения
  achieved BOOLEAN DEFAULT FALSE   -- Достигнута ли цель
);
```

#### Таблица: `recommendations`

Хранит персонализированные рекомендации для пользователя.

```sql
CREATE TABLE IF NOT EXISTS recommendations (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,                    -- Заголовок рекомендации
  description TEXT NOT NULL,              -- Описание
  category TEXT NOT NULL,                 -- Категория
  priority INTEGER DEFAULT 1,             -- Приоритет (1-высокий, 3-низкий)
  completed BOOLEAN DEFAULT FALSE,        -- Выполнена ли
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP  -- Дата создания
);
```

**Категории (category):**
- `exercise` - Упражнения и активность
- `nutrition` - Питание
- `sleep` - Сон
- `general` - Общие рекомендации

**Индексы:**
- `idx_goals_type` - на (type)
- `idx_recommendations_category` - на (category)

---

## Функциональность

### 1. Экран Dashboard (Главная панель)

**Назначение:** Основной экран с ключевыми показателями

**Функции:**
- Отображение последних значений ключевых метрик:
  - Шаги
  - ЧСС
  - Сон
  - Вода
  - Калории
  - Вес
- Прогресс к целям для каждой метрики
- Отображение активных рекомендаций (до 3)
- Обновление данных через pull-to-refresh

**Технологии:**
- React Hooks (useState, useEffect)
- SQLite запросы (getLatestHealthMetric, getGoals)
- Компоненты: HealthMetricCard, RecommendationCard

### 2. Экран Health Metrics (Показатели здоровья)

**Назначение:** Детальный просмотр всех метрик

**Функции:**
- Отображение всех 12 типов метрик
- Показ последних значений
- Прогресс к целям
- Индикация отсутствующих данных

**Технологии:**
- Маппинг метрик
- Компонент HealthMetricCard для каждой метрики

### 3. Экран Activity Log (Журнал активности)

**Назначение:** История всех записей активности

**Функции:**
- Группировка записей по датам
- Фильтрация по периодам (7, 14, 30 дней)
- Отображение всех метрик с временными метками
- Сортировка по дате (новые сверху)

**Технологии:**
- SQLite запросы с фильтрацией по датам
- Группировка данных по дням
- Библиотека date-fns для форматирования дат

### 4. Экран Analytics (Аналитика)

**Назначение:** Графики и анализ тенденций

**Функции:**
- Интерактивные графики для выбранных метрик
- Выбор метрики (ЧСС, шаги, сон, вес, вода, калории)
- Выбор временного периода (7, 14, 30 дней)
- Статистика: максимум, минимум, среднее значение
- Визуализация трендов

**Технологии:**
- Victory Charts для графиков
- Агрегация данных (группировка по дням, средние значения)
- Компонент TrendChart

### 5. Экран Recommendations (Рекомендации)

**Назначение:** Персонализированные рекомендации

**Функции:**
- Генерация рекомендаций на основе анализа данных
- Отображение активных и выполненных рекомендаций
- Приоритизация рекомендаций
- Отметка о выполнении

**Алгоритм генерации рекомендаций:**
1. Анализ шагов: сравнивает среднее значение за неделю с целью
2. Анализ воды: проверяет дневное потребление (норма 2000мл)
3. Анализ сна: проверяет среднюю продолжительность (норма 7.5 часов)
4. Анализ веса: отслеживает изменения за месяц
5. Анализ активности: общая оценка активности

**Технологии:**
- Класс RecommendationEngine
- SQLite запросы для анализа данных
- Компонент RecommendationCard

### 6. Экран Settings (Настройки)

**Назначение:** Конфигурация приложения

**Функции:**
- Переключение темы (светлая/темная)
- Выбор источника данных:
  - Симуляция
  - IMSIT Watch
  - Устройство (HealthKit/Google Fit)
- Выбор профиля пользователя:
  - Сидячий образ жизни
  - Активный
  - Спортсмен
  - Восстановление
- Включение/выключение симуляции
- Генерация начальных данных (7 дней)

**Технологии:**
- Zustand store для хранения настроек
- AsyncStorage для персистентности
- SimulationService для генерации данных

---

## Система симуляции данных

### Профили пользователей

Приложение поддерживает 4 профиля с разными характеристиками:

1. **Sedentary (Сидячий образ жизни)**
   - ЧСС: 60-85 bpm (базовое: 72)
   - Шаги: 1000-6000 (базовое: 3000)
   - Сон: 5-8 часов (базовое: 6.5)
   - Вода: 1000-2000 мл (базовое: 1500)
   - Калории: 1500-2200 ккал (базовое: 1800)

2. **Active (Активный)**
   - ЧСС: 55-80 bpm (базовое: 68)
   - Шаги: 5000-12000 (базовое: 8000)
   - Сон: 6.5-8.5 часов (базовое: 7.5)
   - Вода: 1800-2800 мл (базовое: 2200)
   - Калории: 2000-3000 ккал (базовое: 2400)

3. **Athlete (Спортсмен)**
   - ЧСС: 45-70 bpm (базовое: 58)
   - Шаги: 8000-18000 (базовое: 12000)
   - Сон: 7-10 часов (базовое: 8.5)
   - Вода: 2500-3500 мл (базовое: 3000)
   - Калории: 2500-4000 ккал (базовое: 3000)

4. **Recovery (Восстановление)**
   - ЧСС: 60-85 bpm (базовое: 70)
   - Шаги: 3000-8000 (базовое: 5000)
   - Сон: 7-9 часов (базовое: 8)
   - Вода: 1500-2500 мл (базовое: 2000)
   - Калории: 1700-2400 ккал (базовое: 2000)

### Алгоритмы симуляции

#### ЧСС (Heart Rate)
- Учитывает время суток (утро: 0.9x, день: 1.1x, вечер: 0.95x, ночь: 0.85x)
- Случайные "тренировки" (10% вероятность повышения на 30 bpm)
- Нормальное распределение с небольшими вариациями

#### Шаги
- Учитывает день недели (выходные: -30%)
- Случайные всплески активности (20% вероятность +30%)
- Базовое значение зависит от профиля

#### Сон
- Корреляция между продолжительностью и качеством
- Больше сна = лучше качество
- Нормальное распределение вокруг базового значения

#### Вес
- Медленные ежедневные изменения (±0.3 кг)
- Ограничение диапазоном профиля

#### Вода и калории
- Учет дня недели
- Нормальное распределение вокруг базового значения

---

## Интеграция с устройствами

### Поддерживаемые источники данных

1. **Simulation (Симуляция)**
   - Генерация реалистичных данных на основе профиля
   - Автоматическое обновление каждые 60 минут
   - Полностью локальная генерация

2. **IMSIT Watch**
   - Интеграция с умными часами IMSIT
   - Симуляция данных с пометкой источника "IMSIT Watch"
   - Готово для подключения реального устройства

3. **Device (Устройство)**
   - Интеграция с HealthKit (iOS) / Google Fit (Android)
   - Чтение данных с устройства
   - Готово для подключения реальных API

### Источник данных в метриках

Каждая метрика помечается источником (source):
- Позволяет отслеживать откуда пришли данные
- Можно фильтровать по источнику
- Показывается в журнале активности

---

## Система рекомендаций

### Алгоритм работы

Класс `RecommendationEngine` анализирует данные и генерирует рекомендации:

1. **Анализ шагов**
   - Сравнивает среднее за неделю с целью
   - Если меньше 80% от цели → рекомендация увеличить активность

2. **Анализ воды**
   - Проверяет дневное потребление
   - Если меньше 70% от нормы (2000мл) → рекомендация пить больше

3. **Анализ сна**
   - Сравнивает среднее с рекомендуемым (7.5 часов)
   - Если дефицит > 1 часа → рекомендация улучшить режим

4. **Анализ веса**
   - Отслеживает изменения за месяц
   - Если изменение > 2 кг → рекомендация консультации

5. **Анализ активности**
   - Оценивает общую активность
   - Низкая активность + низкий пульс → рекомендация тренировок

### Приоритеты

- **1** - Высокий приоритет (требует внимания)
- **2** - Средний приоритет
- **3** - Низкий приоритет

---

## Темная/Светлая тема

### Реализация

- Используется Zustand для хранения выбора темы
- Две цветовые схемы в `utils/colors.ts`:
  - `colors.light` - светлая тема
  - `colors.dark` - темная тема
- Автоматическое переключение на основе системных настроек (userInterfaceStyle: "automatic")

### Цветовая палитра

**Светлая тема:**
- Фон: #FFFFFF
- Поверхность: #F5F5F5
- Текст: #111827
- Акцент: #6366F1

**Темная тема:**
- Фон: #111827
- Поверхность: #1F2937
- Текст: #F9FAFB
- Акцент: #818CF8

---

## Производительность

### Оптимизации

1. **Ленивая загрузка**
   - Компоненты загружаются по мере необходимости
   - Данные подгружаются при открытии экранов

2. **Индексы базы данных**
   - Индексы на часто запрашиваемых полях
   - Оптимизация запросов по датам и типам метрик

3. **Кеширование**
   - Zustand store кеширует настройки
   - AsyncStorage для персистентности

4. **Анимации**
   - React Native Reanimated для нативных анимаций
   - 60 FPS на большинстве устройств

---

## Безопасность

### Хранение данных

- Все данные хранятся локально на устройстве
- Нет передачи данных на внешние серверы
- SQLite база данных защищена файловой системой устройства

### Приватность

- Полностью оффлайн работа
- Нет сбора аналитики
- Пользователь полностью контролирует свои данные

---

## Сборка и развертывание

### Разработка

- Expo Development Build
- Hot Reload для быстрой разработки
- Expo Go для тестирования

### Production Build

- EAS Build для создания APK/IPA
- Оптимизированный bundle
- Минификация кода

---

## Требования к системе

### Для разработки

- Node.js 16+
- npm или yarn
- Expo CLI
- iOS: Xcode (для iOS сборки)
- Android: Android Studio (для Android сборки)

### Для работы приложения

**iOS:**
- iOS 13.0+
- Устройство с поддержкой Expo Go

**Android:**
- Android 6.0+ (API level 23+)
- Устройство с поддержкой Expo Go

---

## Лимитации и будущие улучшения

### Текущие ограничения

1. Интеграция с реальными устройствами (HealthKit/Google Fit) требует дополнительной настройки
2. IMSIT Watch интеграция - симуляция (готово для подключения)
3. Оффлайн только - нет синхронизации между устройствами

### Потенциальные улучшения

1. Реальная интеграция с HealthKit/Google Fit
2. Синхронизация через облако
3. Экспорт данных в различные форматы
4. Расширенная аналитика с ML
5. Социальные функции (соревнования, друзья)
6. Интеграция с фитнес-трекерами

---

## Лицензия

Приложение разработано как полностью локальное решение для учета здоровья.

---

## Контакты и поддержка

Для вопросов и предложений обращайтесь к разработчику.

---

*Документация актуальна на версию 1.0.0*

